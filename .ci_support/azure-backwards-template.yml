steps:
- bash: |
    python .ci_support/pyironconfig.py
    cat ~/.pyiron
  displayName: pyiron config

- bash: |
    conda info -a
    conda config --set always_yes yes --set changeps1 no
    conda install -c anaconda setuptools
    conda update -q conda
  displayName: conda setup

- bash: conda create -n pyiron -q --yes -c conda-forge python=$(python.version)
  displayName: Init environment

- bash: sed 's/=/>=/g' .ci_support/environment.yml > environment.yml
  displayName: update environment

- bash: |
    source activate pyiron
    conda env update --file environment.yml
  displayName: pyiron environment

- bash: |
    source activate pyiron
    pip install --pre .
  displayName: Installing pyiron development version 

- bash: |
    source activate pyiron
    conda env update --file .ci_support/environment-notebooks.yml
  displayName: pyiron notebooks environment

- bash: |
    for f in $(cat .ci_support/exclude); do rm notebooks/$f; done;
  displayName: Remove excluded notebooks 

- bash: |
    source activate pyiron
    ./.ci_support/travis_test_backwards.sh
  displayName: Execute Notebooks
