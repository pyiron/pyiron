language: python

env:
- MINICONDA="https://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh"
  PYTHONVER="2.7" USER="pyiron"
- MINICONDA="https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh"
  PYTHONVER="3.5" USER="pyiron"
- MINICONDA="https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh"
  PYTHONVER="3.6" USER="pyiron"

install:
- sudo apt-get update
- wget ${MINICONDA} -O miniconda.sh
- bash miniconda.sh -b -p $HOME/miniconda
- export PATH="$HOME/miniconda/bin:$PATH"
- conda info -a
- conda config --set always_yes yes --set changeps1 no
- conda update -q conda
- conda install conda-build git make anaconda-client
- conda config --set anaconda_upload yes

script:
- pip install .
- cd tests
- python find_tests.py
- cd ..
- conda build --python ${PYTHONVER} --user ${USER} --token ${CONDA_UPLOAD_TOKEN} conda/pyironbase

deploy:
  provider: pypi
  user: pyiron
  password:
    secure: GTSFSQmY7ja/R4mmXFGMQqgX9b7mTuaYrGQNa6WZzDeE6E6fCzmWSOinoSAiUO4cxBKBsIBVmOk+/PezkGudS6h2Usc0oVlomI7DqTlNkjugm+EDWo6jaVbsoAbpAN7YjHarCdB4WOhcgmosVlzqrtEXw8L1xkAt9ihVBoO9STG9ZTrikyJRt3AfLCCES16bxMSpwzRynkQDT+7dk4Ka5PsY5H6e1pl+otKeIxCFu+FCqCXoA8xanEE8gR/m0xQvaLE9GWXuGJpXbTb9N4OCPrllO7s4RdFf3/jd3eccv48LBV7EEABUs9aoZRchRUC/MDUaPu2jk0l3SixiW88I8FWyfs4eF7NTnkMPsaCsmq+VuC3zQ3obpw5NQVAK7qvumToGD2/ct7G0oy0FZh7fq3f4YlTz+snUaBqyNe9x/oA7qkyoieqOMjQ41bV/9tn0yOfwNb3nzG4WLhgubjOQ5c03BDqfGwwAPl8+as6ptNlTtd4iYp7kHEev2+b+jL0IX9T/sSYPi8/hmfXsG+YJlAKTeib2tqiA1QGjkCJrBCLGAtlBBibJj49UklfYXsadAAqQf+kk15S1W4zsG4PlcbGDdkO1osml7B4sZgYA3OzSj5TgAQvmhXf1pbaH9R06VSanZIieisXjiyrid+BMpC/aKsEanT/Yd/cX4vBNWXA=
